version: '3'

services:
  spring-app:
    container_name: spring-app-withUs
    image: minseok588098/withus
    ports:
      - "8080:8080"
    expose:
      - "8080"
    environment:
      SPRING_REDIS_HOST: redis-server-withUs
      SPRING_REDIS_PORT: 6379
      WEB_DB_URL: ${{ secrets.WEB_DB_URL }}
      WEB_DB_USERNAME: ${{ secrets.WEB_DB_USERNAME }}
      WEB_DB_PASSWORD: ${{ secrets.WEB_DB_PASSWORD }}
      S3_ACCESSKEY: ${{ secrets.S3_ACCESSKEY }}
      S3_BUCKET_NAME: ${{ secrets.S3_BUCKET_NAME }}
      S3_REGION: ${{ secrets.S3_REGION }}
      S3_SECRETKEY: ${{ secrets.S3_SECRETKEY }}
      S3_STACK_AUTO: ${{ secrets.S3_STACK_AUTO }}
      MAIL_USERNAME: ${{ MAIL_USERNAME }}
      MAIL_PASSWORD: ${{ MAIL_PASSWORD }}
      DB_REDIS_HOST: ${{ DB_REDIS_HOST }}
      JWT_SECRET_KEY: ${{ JWT_SECRET_KEY }}
      DEV_DB_URL: ${{ DEV_DB_URL }}
      DEV_DB_USERNAME: ${{ DEV_DB_USERNAME }}
      DEV_DB_PASSWORD: ${{ DEV_DB_PASSWORD }}
      TEST_DB_URL: ${{ TEST_DB_URL }}
      TEST_DB_USERNAME: ${{ TEST_DB_USERNAME }}
      TEST_DB_PASSWORD: ${{ TEST_DB_PASSWORD }}

    depends_on:
      - redis

  redis:
    container_name: redis-server-withUs
    image: redis:latest
    ports:
      - "6379:6379"
    restart: always