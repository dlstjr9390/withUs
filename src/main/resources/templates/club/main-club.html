<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>withUs</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script th:src="@{/js/getclub.js}"></script>
    <script th:src="@{/js/deleteclub.js}"></script>
    <script th:src="@{/js/clubPage.js}"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/clubstyle.css}">
</head>

<body>
<!-- section -->
<nav>
    <div>git
        <section id="club-name">
            <div class="title-container">
                <h1 class="main-title">withUs</h1>
            </div>
        </section>
    </div>
</nav>
<main>
    <div class="all-container">
        <section id="club-title">
            <div class=title-item>
                <article class="club">
                    <h2 class="club-title-name" >클럽 이름</h2>
                </article>
            </div>

            <button id="Notice-post" onclick="navigateToNoticeAddPage()">
                작성
            </button>
            <div class="button-item">
                <article class="club-button-container1">
                    <button id="reviseButton">
                        수정
                    </button>

                </article>
                <article class="club-button-container2">
                    <button id="deleteButton">
                        삭제
                    </button>
                </article>
            </div>
        </section>

        <section id="notice-container">

            <h1 class="Noitce"> Notice </h1>
            <article class="Notice-container">
                <div class="category-list" id = "notice-box">
                </div>
                <nav aria-label="Page navigation example" class="pageNav">
                    <ul class="pagination">
                        </li>
                        <div class="page" id="page">
                        </div>
                        </li>
                    </ul>
                </nav>
            </article>

            <script th:inline="javascript">
                /*<![CDATA[*/
                $(document).ready(function () {
                    fetchNotices();
                    function fetchNotices() {
                        var clubId = Number(window.location.pathname.split('club/').pop().replace(/[^0-9]/g, ''));

                        console.log(clubId)
                        $.ajax({
                                type: 'GET',
                                url: '/api/club/' + clubId + '/notice',
                                contentType:'application/json',
                                success:function (result){
                                    const list = result.data;
                                    const maxCards = 2;
                                    const slicedList = list.slice(0, maxCards);
                                    $(slicedList).each(function (index, res) {
                                        let title = res.title;
                                        const card =
                                            '<div class="board-box">' +
                                            '    <p>' + title + '</p>' +
                                            '</div>';
                                        $('#notice-box').append(card);
                                    });
                                }
                        });

                    }
                    // var clubList = window.location.pathname.split('club/').pop().replace()
                    const cntList = [[${countList}]];
                    // const cntList = /*[[${countList}]]*/ '';
                    console.log(cntList)
                    $(cntList).each(function (index,res){
                        // const card = '<li class="page-item"><a class="page-link" href="@{api/notice/{noticeId}(noticeId=${'+noticeId+'})/comment(page=${'+res+'})}">'+res+'</a></li>';
                        const card = '<li class="page-item" style="float: left"><a class="page-link" onclick="sendPage(\'' + res + '\')">'+res+'</a></li>';
                        $('#page').append(card);
                    })
                });
                /*]]>*/

                function sendPage(pageNumber) {
                    var clubId = Number(window.location.pathname.split('club/').pop().replace(/[^0-9]/g, ''));
                    $('#notice-box').empty();
                    $.ajax({
                        type: 'GET',
                        url: '/api/club/' + clubId + '/notice?page=' + pageNumber,
                        contentType: 'application/json',
                        success: function (result) {
                            const list = result.data;
                            $(list).each(function (index, res) {
                                let title = res.title;

                                const card = '' +
                                    '  <div class="board-box">\n' +
                                    '                     <p>' + title + '</p>\n' +
                                    '                    </div>';
                                $('#notice-box').append(card);
                            });
                        }
                    });
                }
            </script>
        </section>
        <section id="club-container">
            <div class="item1">
                <h1 class="club-introduce" >클럽소개</h1>
                <article class="Club-container">
                    <div class="club-introduce">
                        <div class="club-introduce-box">
                            소개 내용
                        </div>
                    </div>
                </article>
            </div>

            <div class="item2">
                <h1 class="date">날짜</h1>
                <article class="date-container">
                    <div class="start-time"></div>
                    <div class="end-time"></div>

                </article>
            </div>
            <div class="item3">
                <h4 class=invite>클럼 참가자</h4>
                <h5 class=invite-member>

                </h5>
            </div>
        </section>
    </div>

</main>
</body>

</html>
